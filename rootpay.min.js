!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.RootPay=t():e.RootPay=t()}(this,(()=>{return e={316:e=>{!function(t){"use strict";const r={};let o={token:null,apiBaseUrl:null,environment:"sandbox",fields:{},formState:{isValid:!1,isDirty:!1,isFocused:!1,isEmpty:!0,fields:{}},payee_id:null,callbacks:{}};const n={};r.init=function(e){if(!e||!e.token)throw new Error("RootPay: token is required");if(!e||!e.payee_id)throw new Error("RootPay: payee_id is required");o.token=e.token,o.payee_id=e.payee_id,o.environment=e.environment||"production",e.apiBaseUrl?o.apiBaseUrl=e.apiBaseUrl:o.apiBaseUrl="production"===o.environment?"https://api.root-pay.com":"http://localhost:8000",t.addEventListener("message",(function(e){const t=e.data;if(t&&"object"==typeof t){if(t.requestId&&n[t.requestId]){const e=n[t.requestId];return clearTimeout(e.timeoutId),delete n[t.requestId],void(t.success?(e.callback(201,t.data),o.callbacks.onSuccess(t.data)):(e.callback(400,{error:t.error||"Unknown error"}),o.callbacks.onError(t.error||"Unknown error")))}if("FIELD_STATE_CHANGE"===t.type&&t.fieldId){const e=t.fieldId;if(o.fields[e]){const r=o.fields[e];Object.assign(r.state,t.state),void 0!==t.state.value&&(r.state.value=t.state.value);const n=t.fieldType||r.config.name;o.formState.fields[n]=r.state;let a=!0,i=!0;Object.keys(o.formState.fields).forEach((e=>{const t=o.formState.fields[e];t.isValid||(a=!1),t.isEmpty||(i=!1)})),o.formState.isValid=a,o.formState.isEmpty=i}}else if("IFRAME_READY"===t.type&&t.fieldId){const e=t.fieldId;if(o.fields[e]){o.fields[e].isReady=!0;const t=o.fields[e].config;t.style&&Object.keys(t.style).length>0&&updateField(e,{style:t.style}),t.placeholder&&updateField(e,{placeholder:t.placeholder})}}}})),o.callbacks.onSuccess=e.onSuccess||function(){},o.callbacks.onError=e.onError||function(){};const r=function(){function e(e,t,r){const i=`request-${a()}`,s=Object.values(o.fields).map((e=>e.iframe)).filter(Boolean);if(0===s.length)return void r(400,{error:"No secure fields found"});const l={action:"API_REQUEST",endpoint:e,data:t,token:o.token,requestId:i,payee_id:o.payee_id,timestamp:(new Date).getTime()},d=setTimeout((()=>{n[i]&&(delete n[i],r(408,{error:"Request timed out - server may be down or unreachable"}))}),15e3);n[i]={callback:r,timeoutId:d,sentAt:new Date};try{if(!s[0].contentWindow)throw new Error("Iframe contentWindow is not available");s[0].contentWindow.postMessage(l,"*")}catch(e){clearTimeout(d),delete n[i],r(500,{error:"Failed to send request to iframe: "+e.message})}}function r(e,t){const r=document.querySelector(e);if(!r)throw new Error(`RootPay: Container element not found for selector: ${e}`);const n=`secure-field-${a()}`,d=Object.assign({type:"text",name:n,placeholder:"",style:{}},t);t.type?d.name=t.type:t.name;const c={id:n,name:d.name,type:d.type,isValid:!1,isEmpty:!0,isFocused:!1,errors:[],value:""};o.fields[n]={config:d,element:r,iframe:null,state:c,isReady:!1};const u=d.type||d.name;return o.formState.fields[u]=c,s({}),i(r,n,d),{id:n,update:function(e){return l(n,e)}}}function a(){return Math.random().toString(36).substring(2,15)}function i(e,t,r){const n=document.createElement("iframe");n.id=t,n.name=t,n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),n.setAttribute("allowtransparency","true"),n.style.width="100%",n.style.height="100%",n.style.border="none",n.style.outline="none",n.style.overflow="hidden",n.style.backgroundColor="transparent";let a=`${o.apiBaseUrl}/collect/secure-field?field_id=${encodeURIComponent(t)}&field_type=${encodeURIComponent(r.type)}`;r.placeholder&&(a+=`&placeholder=${encodeURIComponent(r.placeholder)}`),a+="&show_label=false",a+="&input_border=none",a+="&input_border_radius=0px",a+="&input_padding=0 12px",a+="&font_size=16px",a+="&input_background=transparent",a+="&input_color=#333",a+="&font_family=Arial, sans-serif",n.setAttribute("src",a),o.fields[t].iframe=n,e.appendChild(n),n.onload=function(){}}function s(e){o.formState=Object.assign({},o.formState,e);let t=!0,r=!0;return Object.keys(o.formState.fields).forEach((e=>{const n=o.formState.fields[e];n.isValid||(t=!1),n.isEmpty||(r=!1)})),o.formState.isValid=t,o.formState.isEmpty=r,o.formState}function l(e,t){const r=o.fields[e];return!(!r||!r.iframe||(t.style&&(r.config.style={...r.config.style,...t.style}),void 0!==t.placeholder&&(r.config.placeholder=t.placeholder),r.iframe.contentWindow.postMessage({action:"UPDATE_FIELD",fieldId:e,config:{style:r.config.style,placeholder:r.config.placeholder}},"*"),0))}function d(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"card";if(0===Object.keys(o.fields).length)return void e(400,{error:"No fields configured"});const n=Object.values(o.fields).map((e=>e.iframe)).filter(Boolean);let a=n.length;if(0===a)return void c(e,r);const i=function(o){const n=o.data;n&&"FIELD_STATE_CHANGE"===n.type&&(a--,a<=0&&(t.removeEventListener("message",i),c(e,r)))};t.addEventListener("message",i),n.forEach((e=>{try{e.contentWindow.postMessage({action:"GET_FIELD_VALUE",fieldId:e.id},"*")}catch(e){a--}})),setTimeout((()=>{a>0&&(t.removeEventListener("message",i),c(e,r))}),1e3)}function c(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"card",n=!1,a=[];const i=o.formState.fields;if(Object.keys(i).forEach((e=>{i[e].value||(n=!0,a.push(e))})),n){let e=!0;if("card"===r){let t=i["card-number"]?.value,r=i["card-expiry"]?.value;t&&r||(Object.keys(o.fields).forEach((e=>{const n=o.fields[e];"card-number"!==n.config.type||t?"card-expiry"!==n.config.type||r||(r=n.state.value,r&&(o.formState.fields["card-expiry"].value=r)):(t=n.state.value,t&&(o.formState.fields["card-number"].value=t))})),t&&r||(e=!1))}else if("bank"===r){let t=i["account-number"]?.value,r=i["routing-number"]?.value;t&&r||(Object.keys(o.fields).forEach((e=>{const n=o.fields[e];"account-number"!==n.config.type||t?"routing-number"!==n.config.type||r||(r=n.state.value,r&&(o.formState.fields["routing-number"].value=r)):(t=n.state.value,t&&(o.formState.fields["account-number"].value=t))})),t&&r||(e=!1))}if(!e)return void t(400,{error:"Some fields are missing values: "+a.join(", ")})}let s={},l="";if("card"===r){const e=i["card-number"]?.value;let r=i["card-expiry"]?.value;if(!e||!r)return void t(400,{error:"Card number and expiry are required"});r=r.replace("/",""),s={card_number:e,card_expiry_date:r},l=`/api/payees/${o.payee_id}/payment-methods/push-to-card`}else{if("bank"!==r)return void t(400,{error:"Invalid payment method type"});{const e=i["account-number"]?.value,r=i["routing-number"]?.value;if(!e||!r)return void t(400,{error:"Account number and routing number are required"});s={account_number:e,routing_number:r,routing_number_type:"aba"},l=`/api/payees/${o.payee_id}/payment-methods/pay-to-bank`}}e(l,s,t)}function u(){return JSON.parse(JSON.stringify(o.formState))}return{field:r,submitPaymentMethod:d,getFormState:u}}();return r},t.RootPay=r,e.exports&&(e.exports=r)}(window)}},t={},function r(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}(316);var e,t}));