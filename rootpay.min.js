!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.RootPay=t():e.RootPay=t()}(this,(()=>{return e={316:e=>{!function(t){"use strict";const r={};let n={token:null,apiBaseUrl:null,environment:"sandbox",fields:{},formState:{isValid:!1,isDirty:!1,isFocused:!1,isEmpty:!0,fields:{}},payee_id:null,paymentMethods:[],callbacks:{}};r.init=function(e){if(!e||!e.token)throw new Error("RootPay: token is required");if(!e||!e.payee_id)throw new Error("RootPay: payee_id is required");n.token=e.token,n.payee_id=e.payee_id,n.environment=e.environment||"production",n.apiBaseUrl=e.apiBaseUrl||"http://localhost:8000",n.callbacks.onSuccess=e.onSuccess||function(){},n.callbacks.onError=e.onError||function(){};const r=function(){function e(e,t,r,o){const a=new XMLHttpRequest;a.open(t,`${n.apiBaseUrl}${e}`,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization",`Bearer ${n.token}`),a.onreadystatechange=function(){if(4===a.readyState){let e;try{e=JSON.parse(a.responseText)}catch(t){e={error:"Invalid response from server"}}o(a.status,e)}},a.onerror=function(){o(0,{error:"Network error"})},r?a.send(JSON.stringify(r)):a.send()}function r(e,t){const r=document.querySelector(e);if(!r)throw new Error(`RootPay: Container element not found for selector: ${e}`);const i=`secure-field-${o()}`,d=Object.assign({type:"text",name:i,placeholder:"",style:{}},t),c={id:i,name:d.name,type:d.type,isValid:!1,isEmpty:!0,isFocused:!1,errors:[]};return n.fields[i]={config:d,element:r,iframe:null,state:c},n.formState.fields[d.name]=c,s({}),a(r,i,d),{id:i,update:function(e){return l(i,e)}}}function o(){return Math.random().toString(36).substring(2,15)}function a(e,r,o){let a;if("card-number"===o.type)a="/collect/card-input";else if("card-expiry"===o.type)a="/collect/card-expiry";else if("account-number"===o.type)a="/collect/account-number";else{if("routing-number"!==o.type)return;a="/collect/routing-number"}const s=document.createElement("iframe");s.id=r,s.name=r,s.setAttribute("frameborder","0"),s.setAttribute("scrolling","no"),s.setAttribute("allowtransparency","true"),s.style.width="100%",s.style.height="40px",s.style.border="none",s.style.outline="none",s.style.overflow="hidden";const d=`${n.apiBaseUrl}${a}?fieldId=${r}&type=${o.type}`;s.setAttribute("src",d),n.fields[r].iframe=s,e.appendChild(s),i(r),n.fields[r].isReady=!1;const c=function(e){e.data&&"IFRAME_READY"===e.data.type&&e.data.fieldId===r&&(n.fields[r].isReady=!0,o.style&&Object.keys(o.style).length>0&&l(r,{style:o.style}),o.placeholder&&l(r,{placeholder:o.placeholder}),t.removeEventListener("message",c))};t.addEventListener("message",c),setTimeout((()=>{n.fields[r].isReady||(n.fields[r].isReady=!0,o.style&&Object.keys(o.style).length>0&&l(r,{style:o.style}),o.placeholder&&l(r,{placeholder:o.placeholder}),t.removeEventListener("message",c))}),1e3)}function i(e){t.addEventListener("message",(function(t){if(!["http://localhost:8010","http://localhost:8000"].includes(t.origin))return;const r=t.data;r&&r.fieldId===e&&"FIELD_STATE_CHANGE"===r.type&&d(e,r.state)}))}function s(e){n.formState=Object.assign({},n.formState,e);let t=!0,r=!0;return Object.keys(n.formState.fields).forEach((e=>{const o=n.formState.fields[e];o.isValid||(t=!1),o.isEmpty||(r=!1)})),n.formState.isValid=t,n.formState.isEmpty=r,n.formState}function d(e,t){const r=n.fields[e];r&&(Object.assign(r.state,t),n.formState.fields[r.config.name]=r.state,s({}))}function l(e,t){const r=n.fields[e];return!(!r||!r.iframe||(t.style&&(r.config.style={...r.config.style,...t.style}),void 0!==t.placeholder&&(r.config.placeholder=t.placeholder),r.iframe.contentWindow.postMessage({action:"UPDATE_FIELD",fieldId:e,config:{style:r.config.style,placeholder:r.config.placeholder}},"*"),0))}function c(t){n.payee_id?e(`/api/payees/${n.payee_id}/payment-methods`,"GET",null,((e,r)=>{200===e&&r.data?(n.paymentMethods=r.data,t(e,{payment_methods:r.data})):t(e,r)})):t(400,{error:"payee_id is required"})}function u(e){c(((t,r)=>{if(200===t){const t=r.payment_methods.find((e=>e.is_default));t?e(200,{default_payment_method:t}):e(404,{error:"No default payment method found"})}else e(t,r)}))}function p(t,r){n.payee_id?e(`/api/payees/${n.payee_id}/payment-methods/${t}/set-default`,"POST",null,((e,o)=>{201===e||200===e?(n.paymentMethods=n.paymentMethods.map((e=>({...e,is_default:e.id===t}))),n.callbacks.onSuccess(o)):n.callbacks.onError(o.error||"Unknown error"),r(e,o)})):r(400,{error:"payee_id is required"})}function f(t,r){n.payee_id?e(`/api/payees/${n.payee_id}/payment-methods/${t}`,"DELETE",null,((e,o)=>{204===e||200===e?(n.paymentMethods=n.paymentMethods.filter((e=>e.id!==t)),n.callbacks.onSuccess(o)):n.callbacks.onError(o.error||"Unknown error"),r(e,o)})):r(400,{error:"payee_id is required"})}function y(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"card";const o=n.formState.fields;let a={},i="";if("card"===r){const e=o["card-number"]?.value;let r=o["card-expiry"]?.value;if(!e||!r)return void t(400,{error:"Card number and expiry are required"});r=r.replace("/",""),a={card_number:e,card_expiry_date:r},i=`/api/payees/${n.payee_id}/payment-methods/push-to-card`}else{if("bank"!==r)return void t(400,{error:"Invalid payment method type"});{const e=o["account-number"]?.value,r=o["routing-number"]?.value;if(!e||!r)return void t(400,{error:"Account number and routing number are required"});a={account_number:e,routing_number:r,routing_number_type:"aba"},i=`/api/payees/${n.payee_id}/payment-methods/pay-to-bank`}}e(i,"POST",a,((e,r)=>{201===e?n.callbacks.onSuccess(r):n.callbacks.onError(r.error||"Unknown error"),t(e,r)}))}function m(){return JSON.parse(JSON.stringify(n.formState))}return{field:r,submitPaymentMethod:y,getFormState:m,getPaymentMethods:c,getDefaultPaymentMethod:u,setDefaultPaymentMethod:p,removePaymentMethod:f}}();return r},t.RootPay=r,e.exports&&(e.exports=r)}(window)}},t={},function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}(316);var e,t}));